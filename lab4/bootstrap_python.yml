- name: Ensure Python3 exists on CentOS
  hosts: host3
  become: yes
  gather_facts: no # чтобы не упало с ошибкой, если нет третьего питона

  tasks:
    - name: Check if python3 is present
      raw: "python3 --version || echo 'absent'"
      register: python_check
      changed_when: false

    - name: Show python version (if present)
      debug:
        msg: 'CentOS Python version: {{ python_check.stdout }}'

    - name: Install python3 if absent
      raw: |
        yum list installed python3 >/dev/null 2>&1 || \
        (yum install -y python3 || dnf install -y python3)
      when: "'absent' in python_check.stdout"
